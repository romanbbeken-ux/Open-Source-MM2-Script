local Players = game:GetService("Players")
local run = game:GetService("RunService")

local function CreateHighlight(Character)
	if (Character and Character:FindFirstChild("Highlight")) then
		return
	end
	
	local ESP = Instance.new("Highlight")
	ESP.Parent = Character
	ESP.FillTransparency = 0.5
	ESP.OutlineColor = Color3.fromRGB(0, 0, 0)
	ESP.FillColor = Color3.fromRGB(0, 255, 0)
end

Players.PlayerAdded:Connect(function(Player)
	Player.CharacterAdded:Connect(function(character)
		CreateHighlight(character)
	end)
end)

for _, Player in pairs(Players:GetPlayers()) do
	Player.CharacterAdded:Connect(function(Character)
        CreateHighlight(Character)
    end)

	if Player.Character then
		CreateHighlight(Player.Character)
	end
end


local function SPYING(Player)
	local Character = Player.Character or Player.CharacterAdded:Wait()
	if not Character then return end
	local ESP = Character.Highlight or Character:WaitForChild("Highlight")
	if not ESP then return end

	ESP.FillColor =Color3.fromRGB(0, 255, 0)

	if (Player.Backpack and Player.Backpack:FindFirstChild("Gun")) or (Character and Character:FindFirstChild("Gun")) then
		ESP.FillColor = Color3.fromRGB(0, 0, 255)
	elseif (Player.Backpack and Player.Backpack:FindFirstChild("Knife")) or (Character and Character:FindFirstChild("Knife")) then
		ESP.FillColor = Color3.fromRGB(255, 0, 0)
	else ESP.FillColor = Color3.fromRGB(0, 255, 0)


	end
end

run.RenderStepped:Connect(function()

	for _, v in pairs(Players:GetPlayers()) do
		local Character = v.Character
		if (Character and Character:FindFirstChild("Highlight")) then
			SPYING(v)
        end
	end
end)
